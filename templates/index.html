<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyroBHC</title>
    <!-- Include the Tailwind CDN script -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- You can also link your own custom CSS file here if needed -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:ital,opsz,wght@0,17..18,400..700;1,17..18,400..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/styles.css">


</head>
<body>
    <div class="sticky w-full h-16">
        <div class="w-full h-full flex flex-row justify-between items-center px-5 shadow">
            <p class="text-2xl font-bold text-black">PyroBHC</p>
            <div class="flex flex-row lg:mr-10 h-16">
                <a href="/" class="nav py-5 border-orange-400 border-b-2">
                    <i class="icon-home lg:hidden"></i><span class="hidden lg:inline">Home</span>
                </a>
                <a href="/Datasets" class="nav py-5">
                    <i class="icon-datasets lg:hidden"></i><span class="hidden lg:inline">Datasets</span>
                </a>
                <a href="/Researcher" class="nav py-5">
                    <i class="icon-researcher lg:hidden"></i><span class="hidden lg:inline">Researcher</span>
                </a>
                <a href="/About" class="nav py-5">
                    <i class="icon-about lg:hidden"></i><span class="hidden lg:inline">About</span>
                </a>
            </div>
        </div>
    </div>
    <div class="relative w-fit h-fit 3xl:h-[35vw] ring-black p-5 m-auto flex flex-col md:flex-row md:space-x-5 items-center space-y-5 my-5">
        <form id="predict-form" class="absolute z-20">
            
            <div id="OilCinputs" class="rounded ring-1 ring-black pb-5 bg-white/90 hidden">
                <div class="my-2 relative px-5 pt-12">
                    <div id="closeOil" class="top-2 absolute right-0 hover:cursor-pointer group active:scale-90">
                        <i class="close-icon group-hover:bg-red-500"></i>
                    </div>
                    <h1 class="mb-2 text-xl font-bold text-gray-700">Composition of biooil</h1>
                    
                    <div class="flex flex-col space-y-1 ">
                        <div class="flex flex-row justify-between">
                            <label for="Precious" class="truncate mr-1">Precious</label>
                            <input type="radio" name="is_precious" id="Precious" class="mr-5" value="true" checked>
                            <label for="None precious" class="truncate mr-1">None precious</label>
                            <input type="radio" name="is_precious" id="None precious" class="" value="false">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="form" class=" ">form</label>
                            <select id="form" class="rounded ring-1 ring-black" name="form">
                                <option value="non">non</option>
                                <option value="mono">mono</option>
                                <option value="bi">bi</option>
                            </select>
                        </div>
                        <div class="border-b-2 my-5 border-gray-400"></div>
                        <div class="flex flex-row justify-between">
                            <label for="Acid" class="truncate">Acid</label>
                            <input name="Acid" id="Acid" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Alcohol" class="truncate">Alcohol</label>
                            <input name="Alcohol" id="Alcohol" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Ketone" class=" ">Ketone</label>
                            <input name="Ketone" id="Ketone" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Aldehyde" class=" ">Aldehyde</label>
                            <input name="Aldehyde" id="Aldehyde" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Furan" class=" ">Furan</label>
                            <input name="Furan" id="Furan" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Sugar" class=" ">Sugar</label>
                            <input name="Sugar" id="Sugar" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Phenol" class=" ">Phenol</label>
                            <input name="Phenol" id="Phenol" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Ester" class=" ">Ester</label>
                            <input name="Ester" id="Ester" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Ether" class=" ">Ether</label>
                            <input name="Ether" id="Ether" class="pinput" value="0" type="float">
                        </div>
                    </div>
                </div>
            </div>
            <div id="OperCinputs" class="rounded ring-1 pb-5 ring-black bg-white/90 hidden">
                <div class="my-2 relative px-5 pt-12">
                    <div id="closeOper" class="top-2 absolute right-0 hover:cursor-pointer group active:scale-90">
                        <i class="close-icon group-hover:bg-red-500"></i>
                    </div>
                    <h1 class="mb-2 text-xl font-bold text-gray-700">Operation condition</h1>
                    
                    <div class="flex flex-col space-y-1">
                        <div class="flex flex-row justify-between">
                            <label for="Cl" class=" ">Cat loading (%wt)</label>
                            <input name="Cl" id="Cl" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Temp" class=" ">Temp (°C)</label>
                            <input name="Temp" id="Temp" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Time" class=" ">Time (h)</label>
                            <input name="Time" id="Time" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Pressure" class=" ">Pressure (bar)</label>
                            <input name="Pressure" id="Pressure" class="pinput" value="0" type="float">
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!-- center panel -->
        <div class="w-[80vw] aspect-[2048/1143] md:w-[50vw] xl:w-[60vw] justify-center relative inline-block">
            <!-- Toggle Button -->
            
            <div class="flex flex-col space-y-5 justify-center">
                <div id="preview" class="relative">
                    
                    <div class="relative w-full h-full overflow-hidden">
                        <img id="Biooil" draggable="false" src="/static/images/biooill.png" class="active:scale-100 png-stroke absolute w-[17.57%] h-[41.81%] left-0 bottom-[0.85%] z-10 hover:scale-105 hover:cursor-pointer" alt="">
                        <img id="Hydrogen" draggable="false" src="/static/images/Hydrogen.png" class="active:scale-100 png-stroke absolute w-[10.6%] h-[50%] left-[17.2%] bottom-[0.85%] z-10 hover:scale-105 hover:cursor-pointer" alt="">
                        <button form="predict-form" type="submit" class="absolute w-[32.32%] h-[74.93%] left-[33.75%] bottom-[0.15%] z-10 hover:scale-105 active:scale-100 group">
                            <img id="Catalyst" draggable="false" src="/static/images/catalyst.png" class="png-stroke w-full h-full object-contain cursor-pointer" alt="Catalyst"/>
                        </button>
                        
                        <img id="mainImage" draggable="false" class="" src="/static/images/process.png" alt="">
                        <div id="info-biooil" class="fixed pointer-events-none opacity-0 z-50 p-4 bg-black/80 border border-white/20 rounded-lg backdrop-blur-md text-white transition-opacity duration-200 w-56">
                            <h3 class="font-bold text-orange-400">Composition of biooil</h3>
                            <p class="text-xs mt-1">Click for opening the input panel</p>
                        </div>
                        <div id="info-hydrogen" class="fixed pointer-events-none opacity-0 z-50 p-4 bg-black/80 border border-white/20 rounded-lg backdrop-blur-md text-white transition-opacity duration-200 w-56">
                            <h3 class="font-bold text-orange-400">Operation condition</h3>
                            <p class="text-xs mt-1">Click for opening the input panel</p>
                        </div>

                        <div id="info-catalyst" class="fixed pointer-events-none opacity-0 z-50 p-4 rounded-lg w-[25vw] transition-opacity duration-200">
                            <h3 class="font-black text-6xl text-stroke">Click to start predicting</h3>
                        </div>
                    </div>
                    
                </div>
                
            </div>

        </div>
        
        
        <!-- right panel -->
        <div class="flex flex-col items-center">
            
            <!-- output -->
            <div class="ml-5 ring-5 rounded ring-gray-700">
                <div class="ring-3 ring-gray-500 p-8 rounded bg-white">
                    <div class="flex flex-row justify-center mb-5 ring-8 ring-gray-300 w-fit h-fit">
                        <button class="ring-2 ring-black w-15 h-10 bg-green-400 hover:cursor-pointer hover:bg-green-300 active:text-sm" form="predict-form" type="submit">Start</button>
                        <button class="ring-2 ring-black w-15 h-10 bg-red-400 hover:cursor-pointer hover:bg-red-300 active:text-sm" form="predict-form" type="reset">Clear</button>
                    </div>
                    <h1 class="text-xl font-black mb-2 text-gray-700">Total HC</h1>
                    <div class="flex flex-col space-y-5">
                        <div class="ring-7 ring-gray-500 rounded-b-md">
                                <div id="totalHC" class="rounded-b-md h-20 w-50 bg-amber-50/90 ring-5 ring-gray-300 flex justify-center items-center">          
                                </div>
                        </div>
                        
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    
        
        
    
    <script>
        const preview = document.getElementById("preview");
        const checkbox = document.getElementById("toggleZoom");
        const zoomPanel = document.getElementById("zoomPanel");
        const full = document.getElementById("full");
        const zoomLevel = 2.5;

        const closeOil = document.getElementById("closeOil");
        closeOil.addEventListener("click", () => {
            oilCinputs.classList.add("hidden")
        });
        const closeOper = document.getElementById("closeOper");
        closeOper.addEventListener("click", () => {
            operCinputs.classList.add("hidden")
        });
        const oilComponents = document.getElementById("Biooil");
        const oilCinputs = document.getElementById("OilCinputs");
        const operCinputs = document.getElementById("OperCinputs");
        const OperCon = document.getElementById("Hydrogen");
        OperCon.addEventListener("click", () => {
            operCinputs.classList.remove("hidden");
        });
        oilComponents.addEventListener("click", () => {
            oilCinputs.classList.remove("hidden");
        });

        document.getElementById("predict-form").addEventListener("submit", async (e) => {
            e.preventDefault();
            const totalHC = document.getElementById("totalHC");
            const formData = new FormData(e.target);
            const payload = Object.fromEntries(formData);
            totalHC.innerHTML = `<svg class="mr-3 size-5 animate-spin" viewBox="0 0 50 50">
                                    <path d="M41.9 23.9c-.3-6.1-4-11.8-9.5-14.4-6-2.7-13.3-1.6-18.3 2.6-4.8 4-7 10.5-5.6 16.6 1.3 6 6 10.9 11.9 12.5 7.1 2 13.6-1.4 17.6-7.2-3.6 4.8-9.1 8-15.2 6.9-6.1-1.1-11.1-5.7-12.5-11.7-1.5-6.4 1.5-13.1 7.2-16.4 5.9-3.4 14.2-2.1 18.1 3.7 1 1.4 1.7 3.1 2 4.8.3 1.4.2 2.9.4 4.3.2 1.3 1.3 3 2.8 2.1 1.3-.8 1.2-2.5 1.1-3.8 0-.4.1.7 0 0z"/>
                                </svg>
                                <span class="text-2xl">Predicting…</span>`;
                                    
            const res = await fetch("/predict", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });
            if (res.ok) {
                const data = await res.json();
                console.log(data);
                totalHC.innerHTML = `<span class="text-xl text-gray-800 font-bold">${data.prediction.toFixed(5)}<span>`;
            }
            else{
                const err = await res.json();
                totalHC.innerHTML = `<span class="text-xl text-gray-800">Insufficient data<span>`;
                alert(err.error);
                return;
            }
            
        });
        const Biooil = document.getElementById('Biooil');
        const Hydrogen = document.getElementById('Hydrogen');
        const Catalyst = document.getElementById('Catalyst');
        const infoBiooil = document.getElementById('info-biooil');
        const infoHydrogen = document.getElementById('info-hydrogen');
        const infoCatalyst = document.getElementById('info-catalyst');

        Biooil.addEventListener('mousemove', (e) => {
            // Show the panel
            infoBiooil.style.opacity = '1';
            
            // Position the panel near the cursor (offset by 15px so it doesn't overlap)
            infoBiooil.style.left = `${e.clientX + 15}px`;
            infoBiooil.style.top = `${e.clientY + 15}px`;
        });
        Biooil.addEventListener('mouseleave', () => {
            // Hide the panel when the mouse leaves
            infoBiooil.style.opacity = '0';
        });
        Hydrogen.addEventListener('mousemove', (e) => {
            // Show the panel
            infoHydrogen.style.opacity = '1';
            
            // Position the panel near the cursor (offset by 15px so it doesn't overlap)
            infoHydrogen.style.left = `${e.clientX + 15}px`;
            infoHydrogen.style.top = `${e.clientY + 0}px`;
        });
        Hydrogen.addEventListener('mouseleave', () => {
            // Hide the panel when the mouse leaves
            infoHydrogen.style.opacity = '0';
        });
        Catalyst.addEventListener('mousemove', (e) => {
            // Show the panel
            infoCatalyst.style.opacity = '1';
            
            // Position the panel near the cursor (offset by 15px so it doesn't overlap)
            infoCatalyst.style.left = `${e.clientX + 15}px`;
            infoCatalyst.style.top = `${e.clientY -100}px`;
        });
        Catalyst.addEventListener('mouseleave', () => {
            // Hide the panel when the mouse leaves
            infoCatalyst.style.opacity = '0';
        });
        
        
        document.addEventListener('DOMContentLoaded', function() {
            // Put your listener here
            window.addEventListener('paste', (e) => {
                const pasteData = (e.clipboardData || window.clipboardData).getData('text');
                const values = pasteData.split('\t').map(v => v.trim());

                const numericFields = [
                    'Acid', 'Alcohol', 'Ketone', 'Aldehyde', 'Furan', 
                    'Sugar', 'Phenol', 'Ester', 'Ether', 'Cl', 'Temp', 'Time', 'Pressure'
                ];

                if (values.length >= 10) {
                    // --- 1. Handle the Typo Mapping ---
                    let rawStatus = values[0].toLowerCase();
                    let isPreciousValue;

                    if (rawStatus === "preciuos") {
                        isPreciousValue = "true";
                    } else if (rawStatus === "non preciuos") {
                        isPreciousValue = "false";
                    } else {
                        // Fallback for standard true/false or other variations
                        isPreciousValue = rawStatus.includes("non") ? "false" : "true";
                    }

                    // Find the radio button by value and check it
                    const radioToClick = document.querySelector(`input[name="is_precious"][value="${isPreciousValue}"]`);
                    if (radioToClick) radioToClick.checked = true;

                    // --- 2. Handle Dropdown (Form) ---
                    const formSelect = document.getElementById('form');
                    if (formSelect) {
                        formSelect.value = values[1]; 
                    }

                    // --- 3. Handle Numeric Fields (starting from index 2) ---
                    numericFields.forEach((id, index) => {
                        const input = document.getElementById(id);
                        const excelIndex = index + 2; 
                        
                        if (input && values[excelIndex] !== undefined) {
                            // Ensure decimals use dots for Python float conversion
                            let cleanValue = values[excelIndex].replace(',', '.');
                            input.value = cleanValue;
                            input.dispatchEvent(new Event('input', { bubbles: true }));
                        }
                    });

                    e.preventDefault();
                }
            });
        });
    </script>
</body>
</html>
