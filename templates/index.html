<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-HTT</title>
    <!-- Include the Tailwind CDN script -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- You can also link your own custom CSS file here if needed -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:ital,opsz,wght@0,17..18,400..700;1,17..18,400..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../static/styles.css">


</head>
<body>
    <div class="sticky w-full h-16">
        <div class="w-full h-full flex flex-row justify-between items-center px-5 shadow">
            <p class="text-2xl font-bold text-black">Multi-HTT</p>
            <div class="flex flex-row lg:mr-10 h-16">
                <a href="/" class="nav py-5 border-black border-b-2">
                    <i class="icon-home lg:hidden"></i><span class="hidden lg:inline">Home</span>
                </a>
                <a href="/Datasets" class="nav py-5">
                    <i class="icon-datasets lg:hidden"></i><span class="hidden lg:inline">Datasets</span>
                </a>
                <a href="/Researcher" class="nav py-5">
                    <i class="icon-researcher lg:hidden"></i><span class="hidden lg:inline">Researcher</span>
                </a>
                <a href="/About" class="nav py-5">
                    <i class="icon-about lg:hidden"></i><span class="hidden lg:inline">About</span>
                </a>
            </div>
        </div>
    </div>
    <div class="relative ring-[6px] bg-slate-100 ring-gray-400 w-fit h-fit 3xl:h-[35vw] ring-black p-5 m-auto flex flex-col md:flex-row md:space-x-5 items-center space-y-5 my-5">
        <form id="predict-form" class="absolute z-20">
            <div id="OilCinputs" class="rounded ring-1 ring-black  pb-5 bg-white hidden">
                <div class="my-2 relative px-5 pt-12">
                    <div id="close" class="top-2 absolute right-0 hover:cursor-pointer group active:scale-90">
                        <i class="close-icon group-hover:bg-red-500"></i>
                    </div>
                    <div class="flex flex-row items-center space-x-1">
                        <i class="mb-2 icon-op"></i>
                        <h1 class="mb-2 text-xl font-bold text-gray-700">Oil components</h1>
                    </div>
                    
                    <div class="flex flex-col space-y-1">
                        <div class="flex flex-row justify-between">
                            <label for="Precious" class="truncate">Precious</label>
                            <input type="radio" name="is_precious" id="Precious" class="" value="true">
                            <label for="None precious" class="truncate">None precious</label>
                            <input type="radio" name="is_precious" id="None precious" class="" value="false">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="form" class=" ">form</label>
                            <select id="form" name="form">
                                <option value="non">non</option>
                                <option value="mono">mono</option>
                                <option value="bi">bi</option>
                            </select>
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Acid" class="truncate">Acid</label>
                            <input name="Acid" id="Acid" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Alcohol" class="truncate">Alcohol</label>
                            <input name="Alcohol" id="Alcohol" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Ketone" class=" ">Ketone</label>
                            <input name="Ketone" id="Ketone" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Aldehyde" class=" ">Aldehyde</label>
                            <input name="Aldehyde" id="Aldehyde" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Furan" class=" ">Furan</label>
                            <input name="Furan" id="Furan" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Sugar" class=" ">Sugar</label>
                            <input name="Sugar" id="Sugar" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Phenol" class=" ">Phenol</label>
                            <input name="Phenol" id="Phenol" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Ester" class=" ">Ester</label>
                            <input name="Ester" id="Ester" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Ether" class=" ">Ether</label>
                            <input name="Ether" id="Ether" class="pinput" value="0" type="float">
                        </div>
                    </div>
                </div>
            </div>
            <div id="OperCinputs" class="rounded ring-1 ring-black p-5 bg-white hidden">
                <div class="my-5">
                    <div class="flex flex-row items-center space-x-1">
                        <i class="mb-2 icon-ep"></i>
                        <h1 class="mb-2 text-xl font-bold text-gray-700">Operation condition</h1>
                    </div>
                    
                    <div class="flex flex-col space-y-1">
                        <div class="flex flex-row justify-between">
                            <label for="Cl" class=" ">Cat loading (%wt)</label>
                            <input name="Cl" id="Cl" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Temp" class=" ">Temp (°C)</label>
                            <input name="Temp" id="Temp" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="time" class=" ">Time (h)</label>
                            <input name="time" id="time" class="pinput" value="0" type="float">
                        </div>
                        <div class="flex flex-row justify-between">
                            <label for="Pressure" class=" ">Pressure (bar)</label>
                            <input name="Pressure" id="Pressure" class="pinput" value="0" type="float">
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!-- center panel -->
        <div class="w-[80vw] aspect-[2048/1143] md:w-[20vw] xl:w-[50vw] justify-center relative inline-block">
            <!-- Toggle Button -->
            
            <div class="flex flex-col space-y-5 justify-center">
                <div id="preview" class="hover:cursor-pointer relative group">
                    <div class="flex flex-row items-center space-x-1 absolute top-7 right-12 z-50 opacity-0 group-hover:opacity-100 duration-700 text-gray-500">
                        <i class="icon-expand"></i>
                        <span> Click to expand</span>
                    </div>
                    
                    <div class=" absolute w-[80vw] aspect-[2048/1143] md:w-[20vw] xl:w-[50vw] glass"></div>
                    <div class="relative w-full h-full">
                        <img id="Biooil" src="/static/images/biooill.png" class="absolute scale-90 w-[17.57%] h-[41.81%] left-8 bottom-[15px] z-10 hover:scale-100" alt="">
                        <img id="mainImage" class="scale-90" src="/static/images/process.png" alt="">
                    </div>
                    
                </div>
                <!-- Toggle Switch -->
                <label class="inline-flex items-center cursor-pointer bg-white w-fit p-1 rounded-full ring-2 ring-gray-400">
                    <span class="select-none ms-3 text-sm font-medium text-heading pr-2">Cursor Zoom</span>
                    <input id="toggleZoom" type="checkbox" value="" class="sr-only peer">
                    <div class="relative w-9 h-5 bg-neutral-200 peer-focus:outline-none 
                    peer-focus:ring-4 peer-focus:ring-brand-soft dark:peer-focus:ring-brand-soft 
                    rounded-full peer peer-checked:bg-green-400 peer-checked:after:translate-x-full 
                    rtl:peer-checked:after:-translate-x-full peer-checked:after:border-buffer after:content-[''] 
                    after:absolute after:top-[2px] after:start-[2px] after:bg-white after:rounded-full after:h-4 
                    after:w-4 after:transition-all peer-checked:bg-brand"></div>
                    
                </label>
                
            </div>
            
            <!-- Zoom Panel -->
            <div
                id="zoomPanel"
                class="
                fixed z-50 pointer-events-none
                w-[200px] h-[120px]
                border border-white/40 rounded-md
                bg-no-repeat bg-cover
                opacity-0
                transition-opacity duration-150
                shadow-lg
                "
            ></div>

            <!-- Overlay -->
            <div
            id="modal"
            class="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm opacity-0 invisible transition-opacity duration-300"
            >
            <img
                id="full"
                src="/static/images/process.jfif"
                class="max-w-[90vw] max-h-[90vh] aspect-[2048/1143] transition-all duration-300 ease-out scale-95 opacity-0"
            />
            </div>
        </div>
        
        
        <!-- right panel -->
        <div class="flex flex-col items-center">
            <div class="flex flex-col space-y-3 justify-center mb-5">
                <button class="ring-2 ring-black w-32 h-10 bg-green-400 hover:bg-gray-200 active:text-sm" form="predict-form" type="submit">Start HTT</button>
                <button class="ring-2 ring-black w-32 h-10 bg-red-400 hover:bg-gray-200 active:text-sm" form="predict-form" type="reset">Clear</button>
            </div>
            <!-- output -->
            <div class="ring-1 ring-black p-5 rounded bg-white">
                <h1 class="text-xl font-bold mb-2 text-gray-700">Product Prediction</h1>
                <div class="flex flex-col space-y-5">
                    <div>
                        <div>
                            <div class="flex flex-row items-center space-x-1 ring-1 ring-black rounded-tl-md rounded-tr-md p-1">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24" fill="none" stroke="rgb(128, 128, 128)" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round">
                                    <!-- Gas bubbles -->
                                    <circle cx="9" cy="14" r="2" />
                                    <circle cx="14" cy="10" r="1.8" />
                                    <circle cx="17" cy="15" r="1.5" />

                                    <!-- Flow -->
                                    <path d="M6 18c2-2 4-6 6-10" />
                                </svg>
                                <h2>Bio-Gas Yield (%w/w)</h2>
                            </div>

                            <div id="gas" class="rounded-b-md h-20 w-50 bg-amber-50 ring-1 ring-black flex justify-center items-center">
                                
                            </div>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    
        
        
    
    <script>
        const preview = document.getElementById("preview");
        const modal = document.getElementById("modal");
        const checkbox = document.getElementById("toggleZoom");
        const img = document.getElementById("mainImage");
        const zoomPanel = document.getElementById("zoomPanel");
        const full = document.getElementById("full");
        const zoomLevel = 2.5;

        const close = document.getElementById("close");
        close.addEventListener("click", () => {
            oilCinputs.classList.add("hidden")
        });
        const oilComponents = document.getElementById("Biooil");
        const oilCinputs = document.getElementById("OilCinputs");
        const operCinputs = document.getElementById("OperCinputs");
        oilComponents.addEventListener("click", () => {
            oilCinputs.classList.remove("hidden");
            // modal.classList.add("opacity-100", "visible");

            // allow opacity transition before scaling
            // setTimeout(() => {
            //     full.classList.remove("scale-95", "opacity-0");
            //     full.classList.add("scale-100", "opacity-100");
            // }, 20);

            document.body.style.overflow = "hidden";
        });
        img.addEventListener("mousemove", (e) => {
            if (!checkbox.checked) return;

            const rect = img.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const xPercent = (x / rect.width) * 100;
            const yPercent = (y / rect.height) * 100;

            zoomPanel.style.backgroundImage = `url(${img.src})`;
            zoomPanel.style.backgroundSize = `${rect.width * zoomLevel}px ${rect.height * zoomLevel}px`;
            zoomPanel.style.backgroundPosition = `${xPercent}% ${yPercent}%`;

            zoomPanel.style.left = `${e.clientX + 18}px`;
            zoomPanel.style.top = `${e.clientY - 18}px`;
            zoomPanel.style.opacity = "1";

            img.style.cursor = "crosshair";
        });

        img.addEventListener("mouseleave", () => {
            zoomPanel.style.opacity = "0";
            img.style.cursor = "pointer";
        });

        modal.addEventListener("click", () => {
            full.classList.add("scale-95", "opacity-0");
            full.classList.remove("scale-100", "opacity-100");

            setTimeout(() => {
                modal.classList.add("opacity-0", "invisible");
                modal.classList.remove("opacity-100", "visible");
                document.body.style.overflow = "auto";
            }, 20);
        });

        document.getElementById("predict-form").addEventListener("submit", async (e) => {
            e.preventDefault();
            const oil = document.getElementById("oil");
            const char = document.getElementById("char");
            const gas = document.getElementById("gas");
            const formData = new FormData(e.target);
            const payload = Object.fromEntries(formData);
            oil.innerHTML = `<svg class="mr-3 size-5 animate-spin" viewBox="0 0 50 50">
                                    <path d="M41.9 23.9c-.3-6.1-4-11.8-9.5-14.4-6-2.7-13.3-1.6-18.3 2.6-4.8 4-7 10.5-5.6 16.6 1.3 6 6 10.9 11.9 12.5 7.1 2 13.6-1.4 17.6-7.2-3.6 4.8-9.1 8-15.2 6.9-6.1-1.1-11.1-5.7-12.5-11.7-1.5-6.4 1.5-13.1 7.2-16.4 5.9-3.4 14.2-2.1 18.1 3.7 1 1.4 1.7 3.1 2 4.8.3 1.4.2 2.9.4 4.3.2 1.3 1.3 3 2.8 2.1 1.3-.8 1.2-2.5 1.1-3.8 0-.4.1.7 0 0z"/>
                                </svg>
                                <span class="text-2xl">Predicting…</span>`;
            char.innerHTML = `<svg class="mr-3 size-5 animate-spin" viewBox="0 0 50 50">
                                    <path d="M41.9 23.9c-.3-6.1-4-11.8-9.5-14.4-6-2.7-13.3-1.6-18.3 2.6-4.8 4-7 10.5-5.6 16.6 1.3 6 6 10.9 11.9 12.5 7.1 2 13.6-1.4 17.6-7.2-3.6 4.8-9.1 8-15.2 6.9-6.1-1.1-11.1-5.7-12.5-11.7-1.5-6.4 1.5-13.1 7.2-16.4 5.9-3.4 14.2-2.1 18.1 3.7 1 1.4 1.7 3.1 2 4.8.3 1.4.2 2.9.4 4.3.2 1.3 1.3 3 2.8 2.1 1.3-.8 1.2-2.5 1.1-3.8 0-.4.1.7 0 0z"/>
                                </svg>
                                <span class="text-2xl">Predicting…</span>`;
            gas.innerHTML = `<svg class="mr-3 size-5 animate-spin" viewBox="0 0 50 50">
                                    <path d="M41.9 23.9c-.3-6.1-4-11.8-9.5-14.4-6-2.7-13.3-1.6-18.3 2.6-4.8 4-7 10.5-5.6 16.6 1.3 6 6 10.9 11.9 12.5 7.1 2 13.6-1.4 17.6-7.2-3.6 4.8-9.1 8-15.2 6.9-6.1-1.1-11.1-5.7-12.5-11.7-1.5-6.4 1.5-13.1 7.2-16.4 5.9-3.4 14.2-2.1 18.1 3.7 1 1.4 1.7 3.1 2 4.8.3 1.4.2 2.9.4 4.3.2 1.3 1.3 3 2.8 2.1 1.3-.8 1.2-2.5 1.1-3.8 0-.4.1.7 0 0z"/>
                                </svg>
                                <span class="text-2xl">Predicting…</span>`;
                                    
            const res = await fetch("/predict", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            });
            if (res.ok) {
                const data = await res.json();
                console.log(data);
                oil.innerHTML = `<span class="text-xl text-gray-800 font-bold">${data.prediction[0].toFixed(5)}<span>`;
                char.innerHTML = `<span class="text-xl text-gray-800 font-bold">${data.prediction[1].toFixed(5)}<span>`;
                gas.innerHTML = `<span class="text-xl text-gray-800 font-bold">${data.prediction[2].toFixed(5)}<span>`;
            }
            else{
                const err = await res.json();
                oil.innerHTML = `<span class="text-xl text-gray-800">Insufficient data<span>`;
                char.innerHTML = `<span class="text-xl text-gray-800">Insufficient data<span>`;
                gas.innerHTML = `<span class="text-xl text-gray-800">Insufficient data<span>`;
                alert(err.error);
                return;
            }
            
        });
    </script>
</body>
</html>
